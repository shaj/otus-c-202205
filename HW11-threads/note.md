# Notes

> Чтение всех файлов в 1 поток: **cpu 1:33,92 total**

## Задание

1. Общее количество отданных байт
2. 10 наиболее тяжелых URL-ов
    - `map<string, int>`
    - Из request извлечь URL
3. 10 наиболее частых рефереров
    - `map<string, int>`

**Разбор строки:** ' ', ' ', ' ', '] "', `request`'" ', `status code`' ', `отдано байт`' "', `referer`'" "', `user-agent`'EOL' 

**request:** ' ', `URL`'?| '

https://github.com/jekstrand/rb-tree

## Как очистить кэш файловой системы в Linux ядре

Начиная с Linux ядра 2.6.16 появилась возможность принудительной очистки системных кэшей:

Чистим pagecache:
`echo 1 > /proc/sys/vm/drop_caches`

Чистим dentrie и inode кэши:
`echo 2 > /proc/sys/vm/drop_caches`

Чистим pagecache, dentrie и inode кэши:
`echo 3 > /proc/sys/vm/drop_caches`

Перед выполнением операции необходимо запустить команду `sync`


```sh
sync && sudo su -c "echo 3 > /proc/sys/vm/drop_caches"
```

## Варианты

`0`  - без потоков
`1`  - один поток на каждый файл. Все файлы читаются одновременно.
       Прочитанные данные сразу пишутся в одну структуру.
`2`  - пул потоков для записи в структуру. Файлы читаются в одном потоке.
       Каждая строка ставится в очередь. Пул потоков обрабатывает очередь.
       Обработанные строки пишутся в одну структуру.
`21` - также, как 2, только в кадом потоке в пуле своя структура данных.
       При завершении потока эти данные объединяются с общей структурой.
`3`  - пул потоков для обработки файла. В очереди сообщений имена файлов
       для обработки. У каждого потока своя структура данных. При выходе
       из потока структура объединяется с общей.

All | User | System | CPU% | принудительное переключение контекста | добровольное переключение контекста | количество чтений с диска

./logscan0
120.23  53.45 10.18   616    2628 19167824
./logscan1
123.04  67.57 17.24  3707  498101 19155304
./logscan2
109.25 116.59 76.30 21605 7082129 19155272
./logscan21
102.41 120.62 74.15  6556 6754924 19155280
./logscan3
174.47  72.71 13.40   944    3211 19155280

./logscan0
103.17 51.67 10.22 59%% 643 2569 19161176
./logscan1
117.56 62.86 14.69 65%% 4143 261889 19155880
./logscan2
98.81 114.62 75.50 192%% 20580 7068735 19157184
./logscan21
108.05 123.34 75.11 183%% 7693 6441106 19160032
./logscan3
123.61 64.72 12.57 62%% 3908 4729 19162720

